<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Langchain on 데브승관</title><link>https://devseunggwan.github.io/docs/tech/langchain/</link><description>Recent content in Langchain on 데브승관</description><generator>Hugo</generator><language>ko-kr</language><atom:link href="https://devseunggwan.github.io/docs/tech/langchain/index.xml" rel="self" type="application/rss+xml"/><item><title>UnstructuredURLLoader 무한 로딩 해결</title><link>https://devseunggwan.github.io/docs/tech/langchain/issue-unstructuredurlloader/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://devseunggwan.github.io/docs/tech/langchain/issue-unstructuredurlloader/</guid><description>&lt;h1 id="unstructuredurlloader-무한-로딩-해결">
 UnstructuredURLLoader 무한 로딩 해결
 &lt;a class="anchor" href="#unstructuredurlloader-%eb%ac%b4%ed%95%9c-%eb%a1%9c%eb%94%a9-%ed%95%b4%ea%b2%b0">#&lt;/a>
&lt;/h1>
&lt;h2 id="요약">
 요약
 &lt;a class="anchor" href="#%ec%9a%94%ec%95%bd">#&lt;/a>
&lt;/h2>
&lt;ul>
&lt;li>UnstructedURLLoader에서 사용하는 라이브러리 중 
 &lt;a href="https://github.com/Unstructured-IO/unstructured/blob/main/unstructured/file_utils/filetype.py">unstructured.file_utils.filetype&lt;/a> 에서 python-magic 라이브러리를 로드할 때 발생하는 이슈였습니다.&lt;/li>
&lt;li>해당 라이브러리를 사용할 떄는 OS 별로 다르게 magic 라이브러리의 종속성을 제공해야 합니다. 그래서 Linux나 MacOS를 사용할 때는 Unstructed 기본 종속성으로 &lt;code>python-magic&lt;/code> 이 설치되어 문제가 없지만, Windows를 사용할 떄는 &lt;code>python-magic-bin&lt;/code> 을 사용하는 환경에 종속성을 추가해야 합니다.
&lt;ul>
&lt;li>Windows: &lt;code>python-magic-bin&lt;/code>&lt;/li>
&lt;li>Linux, MacOS: &lt;code>python-magic&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="상황-설명">
 상황 설명
 &lt;a class="anchor" href="#%ec%83%81%ed%99%a9-%ec%84%a4%eb%aa%85">#&lt;/a>
&lt;/h2>
&lt;ul>
&lt;li>&lt;code>Windows 환경&lt;/code>에서 
 &lt;a href="https://huggingface.co/learn/cookbook/ko/advanced_ko_rag">Hugging-face Open-Source AI Cookbook&lt;/a> 를 보며 LLM 스터디를 진행하고 있었습니다.&lt;/li>
&lt;li>&lt;code>UnstructuredURLLoader&lt;/code>을 사용하여 페이지의 글자들을 가져올 떄 무한 로딩이 걸리는 이슈가 발생하였습니다. 30초 내외로 로드가 완료되어야 정상인데 2분 이상 로드가 완료되지 않는 현상이 발견되었습니다.&lt;/li>
&lt;li>Ubuntu 환경에서도 현상을 재현해보았지만 큰 문제가 없이 로드가 되어 사용할 수 있었습니다.&lt;/li>
&lt;/ul>
&lt;h3 id="예시-코드">
 예시 코드
 &lt;a class="anchor" href="#%ec%98%88%ec%8b%9c-%ec%bd%94%eb%93%9c">#&lt;/a>
&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> langchain_community.document_loaders &lt;span style="color:#f92672">import&lt;/span> UnstructuredURLLoader
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>version &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;v4.49.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>urls &lt;span style="color:#f92672">=&lt;/span> [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;lt;https://huggingface.co/docs/transformers/&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>version&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/ko/pipeline_tutorial&amp;gt;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;lt;https://huggingface.co/docs/transformers/&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>version&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/ko/autoclass_tutorial&amp;gt;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;lt;https://huggingface.co/docs/transformers/&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>version&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/ko/preprocessing&amp;gt;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;lt;https://huggingface.co/docs/transformers/&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>version&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/ko/training&amp;gt;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;lt;https://huggingface.co/docs/transformers/&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>version&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/ko/run_scripts&amp;gt;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;lt;https://huggingface.co/docs/transformers/&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>version&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/ko/tokenizer_summary&amp;gt;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;lt;https://huggingface.co/docs/transformers/&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>version&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/ko/attention&amp;gt;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;lt;https://huggingface.co/docs/transformers/&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>version&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/ko/pad_truncation&amp;gt;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;lt;https://huggingface.co/docs/transformers/&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>version&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/ko/pipeline_webserver&amp;gt;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;lt;https://huggingface.co/docs/transformers/&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>version&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/ko/tasks_explained&amp;gt;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;lt;https://huggingface.co/docs/transformers/&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>version&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/ko/hpo_train&amp;gt;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;lt;https://huggingface.co/docs/transformers/&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>version&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/ko/tasks/sequence_classification&amp;gt;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;lt;https://huggingface.co/docs/transformers/&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>version&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/ko/tasks/token_classification&amp;gt;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;lt;https://huggingface.co/docs/transformers/&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>version&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/ko/tasks/question_answering&amp;gt;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;lt;https://huggingface.co/docs/transformers/&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>version&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/ko/tasks/language_modeling&amp;gt;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;lt;https://huggingface.co/docs/transformers/&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>version&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/ko/tasks/masked_language_modeling&amp;gt;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;lt;https://huggingface.co/docs/transformers/&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>version&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/ko/tasks/translation&amp;gt;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&amp;lt;https://huggingface.co/docs/transformers/&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>version&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/ko/tasks/summarization&amp;gt;&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>loader &lt;span style="color:#f92672">=&lt;/span> UnstructuredURLLoader(urls&lt;span style="color:#f92672">=&lt;/span>urls)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docs &lt;span style="color:#f92672">=&lt;/span> loader&lt;span style="color:#f92672">.&lt;/span>load()
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h2 id="접근-방법">
 접근 방법
 &lt;a class="anchor" href="#%ec%a0%91%ea%b7%bc-%eb%b0%a9%eb%b2%95">#&lt;/a>
&lt;/h2>
&lt;ol>
&lt;li>네트워크가 제한된 망을 사용하고 있던 상황이라 네트워크 이슈라고 생각하여 HTTP 통신을 시도해보았습니다.
&lt;ol>
&lt;li>&lt;code>httpx&lt;/code> 를 사용하여 URL 중 하나에 get 요청을 보내어 정상적으로 요청을 받는 지 확인하였습니다.&lt;/li>
&lt;li>요청 결과는 정상적으로 받아왔었습니다.&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>라이브러리 자체의 문제라고 생각하여 Github에 있는 코드들을 확인 및 직접 실행하여 Blocking이 걸리는 부분을 확인하였습니다.
&lt;ol>
&lt;li>
 &lt;a href="https://github.com/langchain-ai/langchain/blob/7e62e3a137814b6813e11b602b2f78df1dec8d14/libs/community/langchain_community/document_loaders/url.py#L13C7-L13C28">UnstructuredURLLoader&lt;/a>&lt;/li>
&lt;li>
 &lt;a href="https://github.com/Unstructured-IO/unstructured/blob/347a4e5d9ee42f32c1186f0f0dada93bf9910778/unstructured/partition/auto.py#L30">unstructured.partition.auto.partition&lt;/a>&lt;/li>
&lt;li>
 &lt;a href="https://github.com/Unstructured-IO/unstructured/blob/main/unstructured/file_utils/filetype.py">unstructured.file_utils.filetype&lt;/a>&lt;/li>
&lt;li>importlib.import_module(&amp;ldquo;magic&amp;rdquo;)
&lt;ol>
&lt;li>importlib 자체는 라이브러리 로드가 되기 떄문에 magic 문제라 생각하고 magic을 실행하였습니다.&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>magic&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>&lt;code>python-magic&lt;/code> 라이브러리를 Windows에서 사용할 때 발생하는 원인 등을 조사하였습니다.
&lt;ol>
&lt;li>Windows에서는 python-magic 대신 &lt;code>python-magic-bin&lt;/code> 을 사용하여 magic 라이브러리를 사용할 수 있도록 해야 합니다.&lt;/li>
&lt;li>unstructed issue에 다른 유저가 관련 이슈를 올린 것을 확인하였습니다.
&lt;ol>
&lt;li>
 &lt;a href="https://github.com/Unstructured-IO/unstructured/issues/3438">https://github.com/Unstructured-IO/unstructured/issues/3438&lt;/a>&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>최종적으로 &lt;code>python-magic-bin==0.4.14&lt;/code> 를 설치하였을 떄 정상적으로 작동하였습니다.&lt;/li>
&lt;/ol></description></item></channel></rss>
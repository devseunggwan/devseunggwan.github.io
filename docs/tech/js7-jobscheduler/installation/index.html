<!doctype html><html lang=ko-kr dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='
  JS7 JobScheduler Controller and Agent 설치 (w/ docker-compse)
  #


  1. 공식 문서 참조 기준
  #


현재 Alpine 기본 이미지와 OpenJDK와 함께 제공되는 Linux 기반 
  OCI 호환 컨테이너 이미지 에서 제공 
2025.01.03 기준 2.5.0 버전으로 공식 문서에 적혀있어서 참조하였습니다.


  1-1. dotenv 설정
  #


docker-compose 내 설정 값으로 들어가야 하는 항목들을 지정합니다.

JS7USERID=1000
JS7GROUPID=0
JS7VERSION=2-5-0

  1-2. Agent
  #


docker-compose.yml 을 다운로드 받습니다.
agent의 Volume이 마운트 되는 폴더를 생성합니다.

mkdir js7-agent-primary


docker-compose를 실행합니다.

dotenv를 적용해야 합니다.



docker compose --env-file ./.env -f docker-compose.yml up -d

docker-compose.yml
version: &#39;3&#39;
 
services:
  js7-agent-primary:
    image: sosberlin/js7:agent-${JS7VERSION}
    hostname: js7-agent-primary
    volumes:
      - js7-agent-primary:/var/sos-berlin.com/js7/agent/var_4445
    networks:
      - js7
    environment:
      RUN_JS_JAVA_OPTIONS: -Xmx256m
      RUN_JS_USER_ID: "${JS7USERID}:${JS7GROUPID}"
    restart: "no"
 
networks:
  js7:
    external: true
 
volumes:
  js7-agent-primary:
    driver: local
    driver_opts:
      type: none
      device: ${PWD}/js7-agent-primary
      o: bind


  1-3. Controller
  #


docker-compose.yml 을 다운로드 받습니다.
controller의 Volume이 마운트 되는 폴더를 생성합니다.

mkdir js7-controller-primary

docker-compose를 실행합니다.

docker compose --env-file ./.env -f docker-compose.yml up -d 

docker-compose.yml
version: &#39;3&#39;
 
services:
  js7-controller-primary:
    image: sosberlin/js7:controller-${JS7VERSION}
    hostname: js7-controller-primary
    volumes:
      - js7-controller-primary:/var/sos-berlin.com/js7/controller/var
    networks:
      - js7
    environment:
      RUN_JS_JAVA_OPTIONS: -Xmx256m
      RUN_JS_USER_ID: "${JS7USERID}:${JS7GROUPID}"
    restart: "no"
 
networks:
  js7:
    external: true
 
volumes:
  js7-controller-primary:
    driver: local
    driver_opts:
      type: none
      device: ${PWD}/js7-controller-primary
      o: bind
      o: bind


  1-4. JOC Cockpit
  #


MySQL, PostgreSQL 두가지 종류의 DB를 지원합니다. 
(이 중 MySQL을 사용한 설치 예시를 작성하였습니다.)'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://devseunggwan.github.io/docs/tech/js7-jobscheduler/installation/"><meta property="og:site_name" content="데브승관"><meta property="og:title" content="Installation"><meta property="og:description" content='JS7 JobScheduler Controller and Agent 설치 (w/ docker-compse) # 1. 공식 문서 참조 기준 # 현재 Alpine 기본 이미지와 OpenJDK와 함께 제공되는 Linux 기반 OCI 호환 컨테이너 이미지 에서 제공 2025.01.03 기준 2.5.0 버전으로 공식 문서에 적혀있어서 참조하였습니다.
1-1. dotenv 설정 # docker-compose 내 설정 값으로 들어가야 하는 항목들을 지정합니다. JS7USERID=1000 JS7GROUPID=0 JS7VERSION=2-5-0 1-2. Agent # docker-compose.yml 을 다운로드 받습니다. agent의 Volume이 마운트 되는 폴더를 생성합니다. mkdir js7-agent-primary docker-compose를 실행합니다. dotenv를 적용해야 합니다. docker compose --env-file ./.env -f docker-compose.yml up -d docker-compose.yml version: &#39;3&#39; services: js7-agent-primary: image: sosberlin/js7:agent-${JS7VERSION} hostname: js7-agent-primary volumes: - js7-agent-primary:/var/sos-berlin.com/js7/agent/var_4445 networks: - js7 environment: RUN_JS_JAVA_OPTIONS: -Xmx256m RUN_JS_USER_ID: "${JS7USERID}:${JS7GROUPID}" restart: "no" networks: js7: external: true volumes: js7-agent-primary: driver: local driver_opts: type: none device: ${PWD}/js7-agent-primary o: bind 1-3. Controller # docker-compose.yml 을 다운로드 받습니다. controller의 Volume이 마운트 되는 폴더를 생성합니다. mkdir js7-controller-primary docker-compose를 실행합니다. docker compose --env-file ./.env -f docker-compose.yml up -d docker-compose.yml version: &#39;3&#39; services: js7-controller-primary: image: sosberlin/js7:controller-${JS7VERSION} hostname: js7-controller-primary volumes: - js7-controller-primary:/var/sos-berlin.com/js7/controller/var networks: - js7 environment: RUN_JS_JAVA_OPTIONS: -Xmx256m RUN_JS_USER_ID: "${JS7USERID}:${JS7GROUPID}" restart: "no" networks: js7: external: true volumes: js7-controller-primary: driver: local driver_opts: type: none device: ${PWD}/js7-controller-primary o: bind o: bind 1-4. JOC Cockpit # MySQL, PostgreSQL 두가지 종류의 DB를 지원합니다. (이 중 MySQL을 사용한 설치 예시를 작성하였습니다.)'><meta property="og:locale" content="ko_kr"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2025-05-14T05:10:52+00:00"><title>Installation | 데브승관</title>
<link rel=icon href=/favicon.ico><link rel=manifest href=/manifest.json><link rel=canonical href=https://devseunggwan.github.io/docs/tech/js7-jobscheduler/installation/><link rel=stylesheet href=/book.min.5bdce64cc14e50902eb445362149ade3fd10a3447992d8ab8449a29af9631045.css integrity="sha256-W9zmTMFOUJAutEU2IUmt4/0Qo0R5ktirhEmimvljEEU=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.513920e71f759a1088f6a1abd982726ceef2976ebc8c29b6c0a7fa8f0eac9b33.js integrity="sha256-UTkg5x91mhCI9qGr2YJybO7yl268jCm2wKf6jw6smzM=" crossorigin=anonymous></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-ND4BZG3LS1"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ND4BZG3LS1")}</script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/icon.png alt=Logo class=book-icon><span>데브승관</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li class=book-section-flat><span>Tech</span><ul><li><input type=checkbox id=section-a60fa73ba0ca5091982e66ba30dd6598 class=toggle>
<label for=section-a60fa73ba0ca5091982e66ba30dd6598 class="flex justify-between"><a role=button>Airbyte</a></label><ul><li><a href=/docs/tech/airbyte/installation/>Installation</a></li><li><a href=/docs/tech/airbyte/mysql-to-snowflake/>Airbyte를 사용하여 MySQL to Snowflake 연결 시 고려 사항</a></li><li><a href=/docs/tech/airbyte/disk-issue/>Airbyte 운용 시 디스크 용량이 많이 찼을 때 확인해볼 수 있는 것들</a></li></ul></li><li><input type=checkbox id=section-0df090beb6b8424476a21f6272de6438 class=toggle>
<label for=section-0df090beb6b8424476a21f6272de6438 class="flex justify-between"><a role=button>AWS</a></label><ul><li><a href=/docs/tech/aws/aws-lambda/>AWS Lambda 사용 경험 정리</a></li></ul></li><li><input type=checkbox id=section-57ccde6e58abfd82b4c0c706b6cd1770 class=toggle>
<label for=section-57ccde6e58abfd82b4c0c706b6cd1770 class="flex justify-between"><a role=button>Git</a></label><ul><li><a href=/docs/tech/git/gitleaks/>Gitleak</a></li></ul></li><li><input type=checkbox id=section-e13c1742298c6a8c23cd403840d50c94 class=toggle checked>
<label for=section-e13c1742298c6a8c23cd403840d50c94 class="flex justify-between"><a role=button>JS7 JobScheduler</a></label><ul><li><a href=/docs/tech/js7-jobscheduler/introduce/>Introduce</a></li><li><a href=/docs/tech/js7-jobscheduler/installation/ class=active>Installation</a></li><li><a href=/docs/tech/js7-jobscheduler/configuration/>Configuration</a></li></ul></li><li><input type=checkbox id=section-a85f1e2bfc3e5f90a036e102e5e53c6f class=toggle>
<label for=section-a85f1e2bfc3e5f90a036e102e5e53c6f class="flex justify-between"><a role=button>Langchain</a></label><ul><li><a href=/docs/tech/langchain/issue-unstructuredurlloader/>UnstructuredURLLoader 무한 로딩 해결</a></li></ul></li><li><input type=checkbox id=section-711ce98c05a75c48054a4227d171306e class=toggle>
<label for=section-711ce98c05a75c48054a4227d171306e class="flex justify-between"><a role=button>Python</a></label><ul><li><a href=/docs/tech/python/vscode-python-failed-to-resolve-env/>VSCode Python 익스텐션 에러 트러블 슈팅 (Failed to resolve env)</a></li><li><a href=/docs/tech/python/python-rocky-linux-installation/>폐쇄망에 Python 설치 (Rocky Linux 8.10, UV 사용)</a></li></ul></li></ul></li><li class=book-section-flat><span>Book</span><ul><li><input type=checkbox id=section-f41dde8d67e63c2fc20fc13a03f84626 class=toggle>
<label for=section-f41dde8d67e63c2fc20fc13a03f84626 class="flex justify-between"><a role=button>가상 면접 사례로 알아보는 대규모 시스템 설계 기초 1</a></label><ul></ul></li><li><input type=checkbox id=section-cb6caec5d5cb6384bd3b84b7946900c3 class=toggle>
<label for=section-cb6caec5d5cb6384bd3b84b7946900c3 class="flex justify-between"><a role=button>랄프 킴벌의 데이터 웨어하우스 툴킷(The Warehouse Toolkit)</a></label><ul></ul></li></ul></li><li class=book-section-flat><span>Think</span><ul></ul></li><li class=book-section-flat><span>Conference</span><ul></ul></li></ul><ul><li><a href=https://github.com/devseunggwan target=_blank rel=noopener>Github</a></li><li><a href=https://www.linkedin.com/in/seunggwan target=_blank rel=noopener>Linkedin</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Installation</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#js7-jobscheduler-controller-and-agent-설치-w-docker-compse>JS7 JobScheduler Controller and Agent 설치 (w/ docker-compse)</a><ul><li><a href=#1-공식-문서-참조-기준>1. 공식 문서 참조 기준</a><ul><li><a href=#1-1-dotenv-설정>1-1. dotenv 설정</a></li><li><a href=#1-2-agent>1-2. Agent</a></li><li><a href=#1-3-controller>1-3. Controller</a></li><li><a href=#1-4-joc-cockpit>1-4. JOC Cockpit</a></li></ul></li><li><a href=#2-설치-개선>2. 설치 개선</a><ul><li><a href=#2-1-agent-컨테이너에-python-환경-구성>2-1. Agent 컨테이너에 Python 환경 구성</a></li><li><a href=#2-2-docker-compose-통합-및-agent-다중화>2-2. docker-compose 통합 및 Agent 다중화</a></li><li><a href=#2-3-js7-jobscheduler-초기-개발-환경-구성-스크립트-작성>2-3. JS7 JobScheduler 초기 개발 환경 구성 스크립트 작성</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=js7-jobscheduler-controller-and-agent-설치-w-docker-compse>JS7 JobScheduler Controller and Agent 설치 (w/ docker-compse)
<a class=anchor href=#js7-jobscheduler-controller-and-agent-%ec%84%a4%ec%b9%98-w-docker-compse>#</a></h1><h2 id=1-공식-문서-참조-기준>1. 공식 문서 참조 기준
<a class=anchor href=#1-%ea%b3%b5%ec%8b%9d-%eb%ac%b8%ec%84%9c-%ec%b0%b8%ec%a1%b0-%ea%b8%b0%ec%a4%80>#</a></h2><blockquote class="book-hint info"><p>현재 Alpine 기본 이미지와 OpenJDK와 함께 제공되는 Linux 기반
<a href=https://opencontainers.org/>OCI</a> 호환 컨테이너 이미지 에서 제공<br>2025.01.03 기준 2.5.0 버전으로 공식 문서에 적혀있어서 참조하였습니다.</p></blockquote><h3 id=1-1-dotenv-설정>1-1. dotenv 설정
<a class=anchor href=#1-1-dotenv-%ec%84%a4%ec%a0%95>#</a></h3><ol><li>docker-compose 내 설정 값으로 들어가야 하는 항목들을 지정합니다.</li></ol><pre tabindex=0><code>JS7USERID=1000
JS7GROUPID=0
JS7VERSION=2-5-0
</code></pre><h3 id=1-2-agent>1-2. Agent
<a class=anchor href=#1-2-agent>#</a></h3><ol><li>docker-compose.yml 을 다운로드 받습니다.</li><li>agent의 Volume이 마운트 되는 폴더를 생성합니다.<ol><li><code>mkdir js7-agent-primary</code></li></ol></li><li>docker-compose를 실행합니다.<ol><li>dotenv를 적용해야 합니다.</li></ol></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker compose --env-file ./.env -f docker-compose.yml up -d
</span></span></code></pre></div><details><summary><a href="https://kb.sos-berlin.com/download/attachments/80970104/docker-compose.yml?version=2&#x26;modificationDate=1654531801000&#x26;api=v2">docker-compose.yml</a></summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3&#39;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>js7-agent-primary</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>sosberlin/js7:agent-${JS7VERSION}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>hostname</span>: <span style=color:#ae81ff>js7-agent-primary</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>js7-agent-primary:/var/sos-berlin.com/js7/agent/var_4445</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>js7</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>RUN_JS_JAVA_OPTIONS</span>: -<span style=color:#ae81ff>Xmx256m</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>RUN_JS_USER_ID</span>: <span style=color:#e6db74>&#34;${JS7USERID}:${JS7GROUPID}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#e6db74>&#34;no&#34;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>js7</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>external</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>js7-agent-primary</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver</span>: <span style=color:#ae81ff>local</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver_opts</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>none</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>device</span>: <span style=color:#ae81ff>${PWD}/js7-agent-primary</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>o</span>: <span style=color:#ae81ff>bind</span>
</span></span></code></pre></div></details><h3 id=1-3-controller>1-3. Controller
<a class=anchor href=#1-3-controller>#</a></h3><ol><li>docker-compose.yml 을 다운로드 받습니다.</li><li>controller의 Volume이 마운트 되는 폴더를 생성합니다.</li></ol><pre tabindex=0><code>mkdir js7-controller-primary
</code></pre><ol start=3><li>docker-compose를 실행합니다.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker compose --env-file ./.env -f docker-compose.yml up -d 
</span></span></code></pre></div><details><summary><a href="https://kb.sos-berlin.com/download/attachments/80970088/docker-compose.yml?version=1&#x26;modificationDate=1654530751000&#x26;api=v2">docker-compose.yml</a></summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3&#39;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>js7-controller-primary</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>sosberlin/js7:controller-${JS7VERSION}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>hostname</span>: <span style=color:#ae81ff>js7-controller-primary</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>js7-controller-primary:/var/sos-berlin.com/js7/controller/var</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>js7</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>RUN_JS_JAVA_OPTIONS</span>: -<span style=color:#ae81ff>Xmx256m</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>RUN_JS_USER_ID</span>: <span style=color:#e6db74>&#34;${JS7USERID}:${JS7GROUPID}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#e6db74>&#34;no&#34;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>js7</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>external</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>js7-controller-primary</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver</span>: <span style=color:#ae81ff>local</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver_opts</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>none</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>device</span>: <span style=color:#ae81ff>${PWD}/js7-controller-primary</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>o</span>: <span style=color:#ae81ff>bind</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>o</span>: <span style=color:#ae81ff>bind</span>
</span></span></code></pre></div></details><h3 id=1-4-joc-cockpit>1-4. JOC Cockpit
<a class=anchor href=#1-4-joc-cockpit>#</a></h3><blockquote><p>MySQL, PostgreSQL 두가지 종류의 DB를 지원합니다.<br>(이 중 MySQL을 사용한 설치 예시를 작성하였습니다.)</p></blockquote><ol><li>docker-compose.yml 및 hibernate.cfg.xml 을 다운로드 받습니다.</li><li>JOC Cockpit의 Volume이 마운트 되는 폴더를 생성합니다.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir db_data
</span></span><span style=display:flex><span>mkdir js7-joc-primary-config
</span></span><span style=display:flex><span>mkdir js7-joc-primary-logs
</span></span></code></pre></div><ol start=3><li>docker-compose를 실행합니다.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker compose --env-file ./.env -f docker-compose.yml up -d
</span></span></code></pre></div><ol start=4><li>hibernate.cfg.yml을 <code>js7-joc-primary-config</code> 폴더로 복사합니다.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cp -f hibernate.cfg.xml js7-joc-primary-config/
</span></span></code></pre></div><ol start=5><li>JS7 Scheduler의 메타 정보를 저장하는 MySQL을 초기화합니다.</li></ol><ul><li>초기화 진행</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose exec js7-joc-primary /bin/sh -c /opt/sos-berlin.com/js7/joc/install/joc_install_tablessh
</span></span></code></pre></div><ul><li>결과 확인</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tail js7-joc-primary-logs/install-result.log
</span></span></code></pre></div><details><summary><a href="https://kb.sos-berlin.com/download/attachments/80970015/docker-compose.yml?version=2&#x26;modificationDate=1654526940000&#x26;api=v2">docker-compose.yml</a></summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3&#39;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>db</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>mysql:8.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>: --<span style=color:#ae81ff>default-authentication-plugin=mysql_native_password</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>db_data:/var/lib/mysql</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;3306:3306&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>js7</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>MYSQL_ROOT_PASSWORD</span>: <span style=color:#ae81ff>js7rootpassword</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>MYSQL_DATABASE</span>: <span style=color:#ae81ff>js7db</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>MYSQL_USER</span>: <span style=color:#ae81ff>js7user</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>MYSQL_PASSWORD</span>: <span style=color:#ae81ff>js7password</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#e6db74>&#34;no&#34;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>  <span style=color:#f92672>js7-joc-primary</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>db</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>js7-joc-primary</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>sosberlin/js7:joc-${JS7VERSION}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>hostname</span>: <span style=color:#ae81ff>js7-joc-primary</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;17446:4446&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>js7</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>js7-joc-primary-config:/var/sos-berlin.com/js7/joc/resources/joc</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>js7-joc-primary-logs:/var/sos-berlin.com/js7/joc/logs</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>RUN_JS_JAVA_OPTIONS</span>: -<span style=color:#ae81ff>Xmx256m</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>RUN_JS_USER_ID</span>: <span style=color:#e6db74>&#34;${JS7USERID}:${JS7GROUPID}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#e6db74>&#34;no&#34;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>js7</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>external</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>db_data</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver</span>: <span style=color:#ae81ff>local</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver_opts</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>none</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>device</span>: <span style=color:#ae81ff>${PWD}/db_data</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>o</span>: <span style=color:#ae81ff>bind</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>  <span style=color:#f92672>js7-joc-primary-config</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver</span>: <span style=color:#ae81ff>local</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver_opts</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>none</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>device</span>: <span style=color:#ae81ff>${PWD}/js7-joc-primary-config</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>o</span>: <span style=color:#ae81ff>bind</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>  <span style=color:#f92672>js7-joc-primary-logs</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver</span>: <span style=color:#ae81ff>local</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver_opts</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>none</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>device</span>: <span style=color:#ae81ff>${PWD}/js7-joc-primary-logs</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>o</span>: <span style=color:#ae81ff>bind</span>
</span></span></code></pre></div></details><details><summary><a href="https://kb.sos-berlin.com/download/attachments/80970015/hibernate.cfg.xml?version=1&#x26;modificationDate=1654524637000&#x26;api=v2">hibernate.cfg.xml</a></summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; standalone=&#34;no&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;hibernate-configuration&gt;</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>&lt;session-factory&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;hibernate.connection.driver_class&#34;</span><span style=color:#f92672>&gt;</span>org.mariadb.jdbc.Driver<span style=color:#f92672>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;hibernate.connection.password&#34;</span><span style=color:#f92672>&gt;</span>js7password<span style=color:#f92672>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;hibernate.connection.url&#34;</span><span style=color:#f92672>&gt;</span>jdbc:mariadb://db:3306/js7db<span style=color:#f92672>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;hibernate.connection.username&#34;</span><span style=color:#f92672>&gt;</span>js7user<span style=color:#f92672>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;hibernate.dialect&#34;</span><span style=color:#f92672>&gt;</span>org.hibernate.dialect.MySQLInnoDBDialect<span style=color:#f92672>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;hibernate.show_sql&#34;</span><span style=color:#f92672>&gt;</span>false<span style=color:#f92672>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;hibernate.connection.autocommit&#34;</span><span style=color:#f92672>&gt;</span>false<span style=color:#f92672>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;hibernate.format_sql&#34;</span><span style=color:#f92672>&gt;</span>true<span style=color:#f92672>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;hibernate.temp.use_jdbc_metadata_defaults&#34;</span><span style=color:#f92672>&gt;</span>false<span style=color:#f92672>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;hibernate.connection.provider_class&#34;</span><span style=color:#f92672>&gt;</span>org.hibernate.hikaricp.internal.HikariCPConnectionProvider<span style=color:#f92672>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;hibernate.hikari.maximumPoolSize&#34;</span><span style=color:#f92672>&gt;</span>10<span style=color:#f92672>&lt;/property&gt;</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>&lt;/session-factory&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/hibernate-configuration&gt;</span>
</span></span></code></pre></div></details><h2 id=2-설치-개선>2. 설치 개선
<a class=anchor href=#2-%ec%84%a4%ec%b9%98-%ea%b0%9c%ec%84%a0>#</a></h2><blockquote><p>공식 문서에는 2.5.0 버전으로 설치를 진행하게 되어 있지만, 최근까지 계속 메인테이너가 개발을 하고 있고 Stable Version이 2.7.3이여서 해당 버전으로 개선안을 작성했습니다.</p></blockquote><h3 id=2-1-agent-컨테이너에-python-환경-구성>2-1. Agent 컨테이너에 Python 환경 구성
<a class=anchor href=#2-1-agent-%ec%bb%a8%ed%85%8c%ec%9d%b4%eb%84%88%ec%97%90-python-%ed%99%98%ea%b2%bd-%ea%b5%ac%ec%84%b1>#</a></h3><p>기존 빌드된 컨테이너에는 Python 환경이 구성되지 않았습니다. Python을 실행하기 위해서 기존 이미지를 바탕으로 새로운 이미지를 빌드해야 했습니다. Python과 의존성을 가지는 환경을 Dockerfile로 구성했습니다. Python 환경, 파일들을 공유할 폴더도 생성하도록 추가했습니다.</p><blockquote><p>Python은 UV 기반으로 구성할 예정이여서 설치 스크립트가 추가되어 있습니다. 사용하는 환경에 따라서 Dockerfile 구성을 변경하면 됩니다.</p></blockquote><details><summary>Dockerfile</summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> sosberlin/js7:agent-2-7-3</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> apk add <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    wget <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    gcc <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    make <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    zlib-dev <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    libffi-dev <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    openssl-dev <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    musl-dev<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> apk add --no-cache python3 python3-dev py3-pip<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> curl --proto <span style=color:#e6db74>&#39;=https&#39;</span> --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> PATH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$PATH<span style=color:#e6db74>:/root/.cargo/bin&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> curl -LsSf https://astral.sh/uv/install.sh | sh<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> PATH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$PATH<span style=color:#e6db74>:/root/.local/bin&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mkdir /var/sos-berlin.com/js7/agent/workspace<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div></details><blockquote class="book-hint danger"><p><strong>파이썬 사용 시 주의사항</strong></p><ul><li><p>JS7 JobScheduler에서 사용한 컨테이너는 Alpine Linux 를 사용했습니다. Alpine Linux는 C 컴파일에 musl을 사용하기 때문에 Python의 특정 라이브러리를 설치 시 binary wheel 을 사용하지 못합니다.</p></li><li><p>그래서 설치시 C 코드를 컴파일해야 하는 문제점이 발생합니다. 해당 문제 때문에 설치 시간이 기존 보다 몇 (십)배는 느려지는 이슈가 있습니다. 그래서 라이브러리 사용에 제약 사항이 발생할 수 있습니다.</p></li><li><p><a href=https://eden-do.tistory.com/64>https://eden-do.tistory.com/64</a></p></li><li><p><a href=https://nx006.tistory.com/70>https://nx006.tistory.com/70</a></p></li></ul></blockquote><h3 id=2-2-docker-compose-통합-및-agent-다중화>2-2. docker-compose 통합 및 Agent 다중화
<a class=anchor href=#2-2-docker-compose-%ed%86%b5%ed%95%a9-%eb%b0%8f-agent-%eb%8b%a4%ec%a4%91%ed%99%94>#</a></h3><p>문서에는 Agent, Controller, JOC를 각각의 docker-compose 파일로 분리했었습니다. 개발 환경을 구성할 떄 편리함을 위해서 한 개의 docker-compose 파일로 통합하였습니다.</p><p>그리고 Enterprise 버전을 사용하지 않더라도 여러 개의 Standalone Agent를 Controller에 등록할 수 있습니다. 그래서 여러 개의 Agent를 사용하도록 deploy 옵션을 추가했습니다. Replicas 옵션은 dotenv에서 수정할 수 있도록 하였습니다.</p><p>그리고 각 Agent가 실행할 코드를 공유할 수 있도록 docker volume를 추가하였습니다. Python 코드를 Git Repo에서 Pull 방식으로 배포 후 Agent 에서 사용할 수 있도록 하기 위해 해당 방법으로 구성 하였습니다.. Rolling이나 Blue/Green 등배포 전략을 사용하기에는 Agent 를 Controller에서 등록하는 방식때문에 배포 전략을 사용하기 어려운 점도 고려했습니다.</p><details><summary>dotenv</summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>JS7USERID=1000
</span></span><span style=display:flex><span>JS7GROUPID=0
</span></span><span style=display:flex><span>JS7VERSION=2-7-3
</span></span><span style=display:flex><span>JS7_AGENT_REPLICAS=3
</span></span></code></pre></div></details><details><summary>docker-compose.yml</summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>db</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>mysql:8.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;3306:3306&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>:
</span></span><span style=display:flex><span>      - --<span style=color:#ae81ff>default-authentication-plugin=caching_sha2_password</span>
</span></span><span style=display:flex><span>      - --<span style=color:#ae81ff>character-set-server=utf8mb4</span>
</span></span><span style=display:flex><span>      - --<span style=color:#ae81ff>collation-server=utf8mb4_bin</span>
</span></span><span style=display:flex><span>      - --<span style=color:#ae81ff>skip-character-set-client-handshake</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>db_data:/var/lib/mysql</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>js7</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>MYSQL_ROOT_PASSWORD</span>: <span style=color:#ae81ff>iHateMySQL8.0!</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>MYSQL_DATABASE</span>: <span style=color:#ae81ff>js7db</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>MYSQL_USER</span>: <span style=color:#ae81ff>js7user</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>MYSQL_PASSWORD</span>: <span style=color:#ae81ff>js7password</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#e6db74>&#34;no&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>js7-joc-primary</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>db</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>sosberlin/js7:joc-${JS7VERSION}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>hostname</span>: <span style=color:#ae81ff>js7-joc-primary</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;17443:4446&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>js7-joc-primary-config:/var/sos-berlin.com/js7/joc/resources/joc</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>js7-joc-primary-logs:/var/log/sos-berlin.com/js7/joc</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>js7</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>RUN_JS_JAVA_OPTIONS</span>: -<span style=color:#ae81ff>Xmx256m</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>RUN_JS_USER_ID</span>: <span style=color:#e6db74>&#34;${JS7USERID}:${JS7GROUPID}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#e6db74>&#34;no&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>js7-controller-primary</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>sosberlin/js7:controller-${JS7VERSION}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>hostname</span>: <span style=color:#ae81ff>js7-controller-primary</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>js7-controller-primary:/var/sos-berlin.com/js7/controller</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>js7</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>RUN_JS_JAVA_OPTIONS</span>: -<span style=color:#ae81ff>Xmx256m</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>RUN_JS_USER_ID</span>: <span style=color:#e6db74>&#34;${JS7USERID}:${JS7GROUPID}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#e6db74>&#34;no&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>js7-agent-primary</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>.</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>Dockerfile.js7-agent</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>entrypoint</span>: <span style=color:#ae81ff>entrypoint.sh</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>hostname</span>: <span style=color:#ae81ff>js7-agent-primary</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>js7-agent-primary-workspace:/var/sos-berlin.com/js7/agent/workspace</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>js7</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>RUN_JS_JAVA_OPTIONS</span>: -<span style=color:#ae81ff>Xmx256m</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>RUN_JS_USER_ID</span>: <span style=color:#e6db74>&#34;${JS7USERID}:${JS7GROUPID}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#e6db74>&#34;no&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>deploy</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>mode</span>: <span style=color:#ae81ff>replicated</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>${JS7_AGENT_REPLICAS}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>endpoint_mode</span>: <span style=color:#ae81ff>vip</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>db_data</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver</span>: <span style=color:#ae81ff>local</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver_opts</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>none</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>device</span>: <span style=color:#ae81ff>${PWD}/db_data</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>o</span>: <span style=color:#ae81ff>bind</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>js7-joc-primary-config</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver</span>: <span style=color:#ae81ff>local</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver_opts</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>none</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>device</span>: <span style=color:#ae81ff>${PWD}/js7-joc-primary-config</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>o</span>: <span style=color:#ae81ff>bind</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>js7-joc-primary-logs</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver</span>: <span style=color:#ae81ff>local</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver_opts</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>none</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>device</span>: <span style=color:#ae81ff>${PWD}/js7-joc-primary-logs</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>o</span>: <span style=color:#ae81ff>bind</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>js7-controller-primary</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver</span>: <span style=color:#ae81ff>local</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver_opts</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>none</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>device</span>: <span style=color:#ae81ff>${PWD}/js7-controller-primary</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>o</span>: <span style=color:#ae81ff>bind</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>js7-agent-primary-workspace</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver</span>: <span style=color:#ae81ff>local</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver_opts</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>none</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>device</span>: <span style=color:#ae81ff>${PWD}/js7-agent-primary-workspace</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>o</span>: <span style=color:#ae81ff>bind</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>js7</span>:
</span></span></code></pre></div></details><h3 id=2-3-js7-jobscheduler-초기-개발-환경-구성-스크립트-작성>2-3. JS7 JobScheduler 초기 개발 환경 구성 스크립트 작성
<a class=anchor href=#2-3-js7-jobscheduler-%ec%b4%88%ea%b8%b0-%ea%b0%9c%eb%b0%9c-%ed%99%98%ea%b2%bd-%ea%b5%ac%ec%84%b1-%ec%8a%a4%ed%81%ac%eb%a6%bd%ed%8a%b8-%ec%9e%91%ec%84%b1>#</a></h3><p>일련의 작업 과정을 자동화하기 위해 스크립트를 작성하였습니다. docker-compose up 이후 20초 정도 기다렸다가 DB 초기화 작업을 진행합니다.</p><p>만약 DB 초기화 중 에러가 발생하였다면, 스크립트의 마지막 두 줄을 다시 실행하여야 합니다. 초기화가 완료되지 않는다면, JOC가 열리지 않습니다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>mkdir js7-agent-workspace
</span></span><span style=display:flex><span>mkdir js7-controller-primary
</span></span><span style=display:flex><span>mkdir js7-joc-primary-config
</span></span><span style=display:flex><span>mkdir js7-joc-primary-logs
</span></span><span style=display:flex><span>mkdir db_data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker compose --env-file ./.env -f docker-compose.yml up -d
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;Waiting for the database to start...&#34;</span>
</span></span><span style=display:flex><span>sleep <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cp -f hibernate.cfg.xml js7-joc-primary-config/
</span></span><span style=display:flex><span>docker-compose exec js7-joc-primary /bin/bash -c /opt/sos-berlin.com/js7/joc/install/joc_install_tables.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker-compose restart js7-joc-primary
</span></span></code></pre></div><h2 id=reference>Reference
<a class=anchor href=#reference>#</a></h2><ul><li><a href="https://kb.sos-berlin.com/display/JS7/JS7+-+Installation+for+Containers?src=contextnavpagetreemode">https://kb.sos-berlin.com/display/JS7/JS7+-+Installation+for+Containers?src=contextnavpagetreemode</a></li><li><a href=https://qiita.com/saitamanokusa/items/ffb8f05cbc8e75d435ce>https://qiita.com/saitamanokusa/items/ffb8f05cbc8e75d435ce</a></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/devseunggwan/blog-hugo/commit/1c44b916b2f82f9f6780b9b7ba836f715a691cde title='Last modified by Seunggwan Song | May 14, 2025' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt>
<span>May 14, 2025</span></a></div><div><a class="flex align-center" href=https://github.com/devseunggwan/blog-hugo/edit/main/exampleSite/content/docs/tech/js7-jobscheduler/installation.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#js7-jobscheduler-controller-and-agent-설치-w-docker-compse>JS7 JobScheduler Controller and Agent 설치 (w/ docker-compse)</a><ul><li><a href=#1-공식-문서-참조-기준>1. 공식 문서 참조 기준</a><ul><li><a href=#1-1-dotenv-설정>1-1. dotenv 설정</a></li><li><a href=#1-2-agent>1-2. Agent</a></li><li><a href=#1-3-controller>1-3. Controller</a></li><li><a href=#1-4-joc-cockpit>1-4. JOC Cockpit</a></li></ul></li><li><a href=#2-설치-개선>2. 설치 개선</a><ul><li><a href=#2-1-agent-컨테이너에-python-환경-구성>2-1. Agent 컨테이너에 Python 환경 구성</a></li><li><a href=#2-2-docker-compose-통합-및-agent-다중화>2-2. docker-compose 통합 및 Agent 다중화</a></li><li><a href=#2-3-js7-jobscheduler-초기-개발-환경-구성-스크립트-작성>2-3. JS7 JobScheduler 초기 개발 환경 구성 스크립트 작성</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></li></ul></nav></div></aside></main></body></html>